define(["jquery"],function(a){var b=function(b){var c=a("#fitem_id_profile_field_"+b);return 0===c.length&&(c=a(".fitem [name=profile_field_"+b+"], .fitem [name^=profile_field_"+b+"\\[]").closest(".fitem.row")),c},c=function(b,c,d,e){this.fieldName=b,this.conditions=a.parseJSON(c);var f=[];this.conditions.forEach(function(b){b.hiddenfields.forEach(function(b){a.inArray(b,f)==-1&&f.push(b)}),b.requiredfields.forEach(function(b){a.inArray(b,f)==-1&&f.push(b)})}),this.allElements=f,this.hiddenElements={},this.hideAll=1==d,this.reqHTML=e,this.initApplyRule(),a("#id_profile_field_"+b).change(this.applyRule.bind(this)).closest("form").submit(this.beforeSubmit.bind(this))};return c.prototype.fieldName=null,c.prototype.conditions=null,c.prototype.allElements=null,c.prototype.hiddenElements=null,c.prototype.hideAll=null,c.prototype.options=null,c.prototype.beforeSubmit=function(a){var c;if(!a.isDefaultPrevented())for(var d in this.hiddenElements)this.hiddenElements.hasOwnProperty(d)&&(c=b(d).html(),""!=c&&(this.hiddenElements[d]=c,b(d).html("")))},c.prototype.initReqStars=function(){var a=[],c=[];this.allElements.forEach(function(c){0===b(c).find(".fitemtitle .req").length&&0===b(c).find("abbr.text-danger").length||a.push(c)}),this.hideAll&&this.conditions.forEach(function(a){a.hiddenfields.forEach(function(a){c.push(a)})}),this.conditions.push({option:"",hiddenfields:c,requiredfields:a})},c.prototype.toggleReqStars=function(){var c,d,e,f=a("#id_profile_field_"+this.fieldName).val(),g=this.reqHTML,h=this.allElements,i=null;this.conditions.forEach(function(j){j.option==f&&(c=j.requiredfields,h.forEach(function(f){d=b(f),null===i&&(i=d.has(".pull-xs-right").length),a.inArray(f,c)!=-1?(i?(e=d.find("abbr.text-danger"),0!==e.length?g=e.html():e=d.find(".req")):e=d.find(".req"),0===e.length&&(e=a(g).hide(),i?d.find(".pull-xs-right").append(e):d.find(".fitemtitle label").append(e)),e.show("slow")):(d.find("abbr.text-danger").hide("slow",function(){a.inArray(f,c)!=-1&&b(f).find("abbr.text-danger").remove()}),d.find(".req").hide("slow",function(){a.inArray(f,c)!=-1&&b(f).find(".req").remove()}))}))}),this.reqHTML=g},c.prototype.applyRule=function(){var c=this.hiddenElements,d=a("#id_profile_field_"+this.fieldName).val(),e=this.hideAll,f=null;this.conditions.forEach(function(g){if(""===d)if(e)g.hiddenfields.forEach(function(a){a in c||(c[a]="",b(a).children().hide("slow"))});else for(f in c)c.hasOwnProperty(f)&&(c[f]&&b(f).html(c[f]),b(f).children().show("slow"),delete c[f]);if(g.option==d){for(f in c)c.hasOwnProperty(f)&&a.inArray(f,g.hiddenfields)==-1&&(c[f]&&b(f).html(c[f]),b(f).children().show("slow"),delete c[f]);g.hiddenfields.forEach(function(a){a in c||(c[a]="",b(a).children().hide("slow"))})}}),this.hiddenElements=c,this.toggleReqStars()},c.prototype.initApplyRule=function(){var a=this.hiddenElements,c=this.hideAll;c&&this.conditions.forEach(function(c){c.hiddenfields.forEach(function(c){c in a||(a[c]="",b(c).children().hide())})}),this.hiddenElements=a,this.initReqStars(),this.applyRule()},{apply:function(a,b,d,e){return new c(a,b,d,e)}}});